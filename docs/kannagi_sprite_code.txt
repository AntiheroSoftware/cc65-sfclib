LKS_Sprite_Draw:

    lda LKS_SPRITE.Enable,y
    and #$FE
    sta LKS_SPRITE.Enable,y

    rep #$20
    lda LKS_SPRITE.X,y
    sec
    sbc LKS_BG.x
    sta MEM_TEMP+4

    lda LKS_SPRITE.Y,y
    sec
    sbc LKS_BG.y
    sta MEM_TEMP+6


    clc
    adc LKS_SPRITE_CTRL.height
    sta MEM_TEMP
    sep #$20

    ; Y
    lda MEM_TEMP+1
    cmp #$00
    beq +
        lda LKS_SPRITE.Enable,y
        ora #$01
        sta LKS_SPRITE.Enable,y
        rtl
    +:

    ;X Right
    lda MEM_TEMP+4+1
    cmp #$01
    bmi +
        lda LKS_SPRITE.Enable,y
        ora #$01
        sta LKS_SPRITE.Enable,y
        rtl
    +:

    ;X Left
    rep #$20
    stz MEM_TEMP+2              ; reset high byte
    lda MEM_TEMP+4
    clc
    adc LKS_SPRITE_CTRL.width
    bcc +
        ldx #$01
        stx MEM_TEMP+2          ; set high byte
    +:
    sta MEM_TEMP
    sep #$20

    lda MEM_TEMP+1
    cmp #$0
    bpl +
        lda LKS_SPRITE.Enable,y
        ora #$01
        sta LKS_SPRITE.Enable,y
        rtl
    +:


    ;Draw
    ldx LKS_SPRITE_CTRL.oam

    lda MEM_TEMP+6
    sta LKS_BUF_OAML+1,x

    lda MEM_TEMP+4
    sta LKS_BUF_OAML+0,x

    lda LKS_SPRITE.Flip,y
    sta LKS_BUF_OAML+3,x

    lda LKS_SPRITE.Tile,y
    sta LKS_BUF_OAML+2,x

    ;end
    rep #$20                ; 16 bit A
    txa
    lsr                     ; shift right ... 4 times
    lsr
    lsr
    lsr
    tax
    sep #$20                ; 8 bit A

    lda LKS_SPRITE.Ext,y
    ora MEM_TEMP+2
    sta LKS_BUF_OAMH,x

    rtl
